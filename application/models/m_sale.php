<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class M_sale extends MY_Model{    function __construct() {        parent::__construct();        $this->load->helper('model');		$this->load->database();    }    public function getItemsByKey($key){        $this->db->select('id,name');        $this->db->like('name',$key);        $this->db->or_like('code',$key);        $q = $this->db->get('product');        return $q->result();    }    public function getCustomers($key){        $this->db->select('id,name,phone');        $this->db->like('name',$key);        $this->db->or_like('code',$key);        $q = $this->db->get('customer');        return $q->result();    }    //change 09/03    public function getListBillSales($where=array(),$limit=null,$offset=null){        $this->db->select('invoices.*');        $this->db->join('customer','customer.id=invoices.customer_id','left');        $this->db->where('invoices.type',0);        $this->db->where('invoices.datetime >=',$where['from']);        $this->db->where('invoices.datetime <=',$where['to']);        if($where['code'] !=''){            $this->db->where('invoices.code',$where['code']);        }        if($where['customer'] !=''){            $this->db->like('customer.name',$where['customer']);        }        $this->db->limit($limit,$offset);        $this->db->order_by('invoices.id','desc');        $q = $this->db->get('invoices');        return $q->result();    }    public function countBillSales($where=array()){        $this->db->select('invoices.id');        $this->db->join('customer','customer.id=invoices.customer_id','left');        $this->db->where('invoices.type',0);        $this->db->where('invoices.datetime >=',$where['from']);        $this->db->where('invoices.datetime <=',$where['to']);        if($where['code'] !=''){            $this->db->where('invoices.code',$where['code']);        }        if($where['customer'] !=''){            $this->db->like('customer.name',$where['customer']);        }        $this->db->order_by('invoices.id','desc');        $q = $this->db->get('invoices');        return $q->num_rows();    }    public function getListReturnInvoices($where=array(),$limit=null,$offset=null){        $this->db->select('invoices.*');        $this->db->join('customer','customer.id=invoices.customer_id','left');        $this->db->where('invoices.type',1);        $this->db->where('invoices.datetime >=',$where['from']);        $this->db->where('invoices.datetime <=',$where['to']);        if($where['code'] !=''){            $this->db->where('invoices.code',$where['code']);        }        if($where['customer'] !=''){            $this->db->like('customer.name',$where['customer']);        }        $this->db->limit($limit,$offset);        $this->db->order_by('invoices.id','desc');        $q = $this->db->get('invoices');        return $q->result();    }    public function getInvoicesByWhere($where=array(),$limit=null,$offset=null){        $this->db->select('invoices.*');        $this->db->join('customer','customer.id=invoices.customer_id','left');        $this->db->where('invoices.type',0);        if($where['code'] != ''){            $this->db->where('invoices.code',$where['code']);        }        if($where['cust'] != ''){            $this->db->like('customer.name',$where['cust']);            $this->db->or_where('customer.phone',$where['cust']);        }        $this->db->where('invoices.datetime >=',$where['from']);        $this->db->where('invoices.datetime <=',$where['to']);        $this->db->limit($limit,$offset);        $this->db->order_by('invoices.id','desc');        $q = $this->db->get('invoices');        return $q->result();    }    public function countInvoicesByWhere($where=array()){        $this->db->select('invoices.id');        $this->db->join('customer','customer.id=invoices.customer_id','left');        $this->db->where('invoices.datetime >=',$where['from']);        $this->db->where('invoices.datetime <=',$where['to']);        if($where['code'] != ''){            $this->db->where('invoices.code',$where['code']);        }        if($where['cust'] != ''){            $this->db->where('customer.name',$where['cust']);            $this->db->or_where('customer.phone',$where['cust']);        }        $this->db->order_by('invoices.id','desc');        $q = $this->db->get('invoices');        return $q->num_rows();    }    public function countInvoices($where=array()){        $this->db->select('id');        $q = $this->db->get('invoices');        return $q->num_rows();    }    public function geLinvoices($cid){        $this->db->select('*');        $this->db->where('customer_id',$cid);        $this->db->order_by('invoices.datetime','desc');        $q=$this->db->get('invoices');        return $q->first_row();    }    public function getItemsByBill($id)    {        $this->db->select('product.id as pid,product.alias,product.name,product.code,        product.quantity as slt,product.price_sale as gb,product.price_import as gn,        invoices_detail.quantity as qty,invoices_detail.price_sale as p_sale,invoices_detail.price_imp as pimp');        $this->db->join('invoices_detail', 'product.id=invoices_detail.product_id');        $this->db->where('invoices_detail.inv_id', $id);        $this->db->order_by('product.id', 'desc');        $q = $this->db->get('product');        return $q->result();    }    public function getCustomerDebt($cid){        $this->db->select('nkd,nkc');        $this->db->where('id_customer',$cid);        $this->db->order_by('id','desc');        $q = $this->db->get('customer_debt');        return $q->first_row();    }}?>